# 采集 UK8S 集群日志

本文将介绍如何在控制台配置 UK8S 集群的日志采集规则并投递到 日志服务 ULS。

## 前提条件

已在 [UK8S控制台](https://console.ucloud.cn/uk8s/manage) 创建集群。

## 集群业务日志采集

### 步骤1：选择日志主题、集群

1. 登录 [ULS 控制台](https://console.ucloud.cn/ulogservice/topic)。

2. 选择接入主题，点击日志接入。
![日志接入1](/images/uk8s/uk8s_access_1.png)

3. 选择接入日志类型，进入选择 UK8S 页面。
![日志接入2](/images/uk8s/uk8s_access_2.png)

4. 选择 UK8S 集群，进入采集配置页面
![日志接入3](/images/uk8s/uk8s_access_3.png)

### 步骤2：配置采集规则

完成集群选择后，单击下一步进入采集配置即可配置采集规则，配置信息如下：

- 日志源配置：
![日志采集1](/images/uk8s/uk8s_collect_1.png)
  - 采集类型：目前采集类型支持容器文件路径；支持指定工作负载、指定 Pod Labels 两种方式指定容器文件路径的采集日志源。

- 元数据配置：
![日志采集2](/images/uk8s/uk8s_collect_2.png)
  除了原始的日志内容， 日志服务还会带上容器或 Kubernetes 相关的元数据（例如：产生日志的容器 ID）一起上报到 ULS，方便用户查看日志时追溯来源或根据容器标识、特征（例如：容器名、labels）进行检索。
  您可以自行选择是否需要上报这些元数据，按需勾选上传。

- 解析规则配置：
![日志采集3](/images/uk8s/uk8s_collect_3.png)
  - 采集策略。您可以选择全量或者增量。
    - 全量：全量采集指从日志文件的开头开始采集。
    - 增量：增量采集指只采集文件内新增的内容。
  - 编码模式：支持 UTF-8和 GBK。
  - 提取模式：支持多种类型的提取模式：
     - JSON
     - 分隔符
     - 单行全文
     - 多行全文
     - 单行完全正则
     - 多行完全正则
    
    **详情参考采集文本日志**

### 步骤3：配置索引

1. 单击完成创建，进入“索引配置”页面。

2. 在“索引配置”页面，设置如下信息
![日志采集4](/images/uk8s/uk8s_collect_4.png)

### 步骤4：检索日志
至此，即完成了 UK8S 集群业务日志采集的所有部署。您可以前往  [控制台 > 检索分析](https://console.ucloud.cn/ulogservice/ulogservice) 查看采集上来的日志。
