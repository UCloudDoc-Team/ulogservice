# 多行全文提取模式采集日志

## 背景信息

在某些业务场景下，一条完整的日志中可能存在换行符，内容跨占了多行。此时如果通过换行符作为日志的结束标识符，可能会错误分隔日志数据，这种情况下可以通过多行全文模式采集日志。
多行全文模式采用首行正则方式进行日志匹配，如果日志数据中第一行匹配了指定的首行正则表达式，则这段数据会被看作是一条日志的起始部分，下一段匹配了首行正则表达式的日志数据作为下一条日志的开头。
如果无需对多行日志内容进行结构化处理、无需提取日志字段进行精细化分析查询，建议使用多行全文模式。

## 操作步骤

### 步骤1：创建/选择日志主题
参考主题、主题集管理

### 步骤2：采集配置

#### 配置日志文件采集路径
![文本路径](/images/text/text_path_1.png)
**文件路径**即日志所在的目录和文件名，ULogAgent 会按照采集路径中的目录部分匹配符合规则的目录，监听这些目录下符合规则的日志文件。最多设置 10 个不同的采集路径。
采集路径可以指定完整的目录和文件名，也可以通过通配符模糊匹配。

常见的采集路径的配置方式及示例如下。

| 配置方式       | 目录前缀表达式 | 文件名表达式 | 说明                                                         |
| -------------- | -------------- | ------------ | ------------------------------------------------------------ |
| 完整文件名称   | /var/log/nginx | access.log   | 此例中，日志文件路径配置为`/var/log/nginx/**/access.log`，ULogAgent 将会监听`/var/log/nginx`前缀路径下所有子目录中以`access.log`命名的日志文件 |
| 文件名后缀匹配 | /var/log/nginx | *.log        | 此例中，日志文件路径配置为`/var/log/nginx/**/*.log`，ULogAgent 将会监听`/var/log/nginx`前缀路径下所有子目录中以`.log`结尾的日志文件 |
| 文件名模糊匹配 | /var/log/nginx | error*       | 此例中，日志文件路径配置为`/var/log/nginx/**/error*`，ULogAgent 将会监听`/var/log/nginx`前缀路径下所有子目录中以`error`开头命名的日志文件 |

#### 配置采集策略
- 全量：ULogAgent 采集文件时，从文件的开头开始读。
- 增量：ULogAgent 采集文件时，只采集文件内新增的内容。

#### 配置编码模式
- UTF-8：若您的日志文件编码模式为 UTF-8，请选择该选项。
- GBK：若您的日志文件编码模式为 GBK，请选择该选项。

#### 配置多行全文格式

1. 在“采集配置”页面，将“提取模式”设置为多行全文。

2. 输入首行正则表达式，日志服务根据指定的首行正则表达式去匹配日志样例。

确认采集配置，并单击完成创建。

### 步骤3：索引配置
![文本路径](/images/text/text_index_1.png)